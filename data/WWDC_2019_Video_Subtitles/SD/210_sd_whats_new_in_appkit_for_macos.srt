1
00:00:00,506 --> 00:00:04,500
[ Music ]


2
00:00:09,516 --> 00:00:15,606
[ Applause ]


3
00:00:16,106 --> 00:00:18,036
>> Hello and good afternoon.


4
00:00:19,086 --> 00:00:20,006
I'm Chris Dreessen.


5
00:00:20,246 --> 00:00:21,716
I work on the Cocoa Frameworks.


6
00:00:22,076 --> 00:00:22,966
And we're going to be talking


7
00:00:22,966 --> 00:00:24,836
about what's new in AppKit this


8
00:00:24,836 --> 00:00:25,036
year.


9
00:00:26,026 --> 00:00:27,796
So, let's dive in.


10
00:00:28,236 --> 00:00:30,816
We have a lot of functionality.


11
00:00:30,886 --> 00:00:32,406
We have some additions to


12
00:00:32,406 --> 00:00:34,056
NSColor, some additions to


13
00:00:34,056 --> 00:00:34,646
NSScreen.


14
00:00:35,086 --> 00:00:36,746
We have a whole grab bag of


15
00:00:36,746 --> 00:00:38,976
features to help you with text


16
00:00:38,976 --> 00:00:39,686
and fonts.


17
00:00:40,356 --> 00:00:41,916
We're going to do a little pub


18
00:00:41,916 --> 00:00:43,286
crawl right here in this


19
00:00:43,286 --> 00:00:43,776
session.


20
00:00:43,806 --> 00:00:44,916
We're going to talk about


21
00:00:44,916 --> 00:00:46,456
toolbar and Touch Bar and


22
00:00:46,456 --> 00:00:47,026
sidebar.


23
00:00:47,026 --> 00:00:49,996
And then we're going to talk


24
00:00:49,996 --> 00:00:51,446
about some new control


25
00:00:51,446 --> 00:00:52,936
functionality in AppKit and


26
00:00:52,936 --> 00:00:54,056
macOS 10.15.


27
00:00:54,266 --> 00:00:55,956
And we'll wrap up our section on


28
00:00:55,956 --> 00:00:58,946
AppKit by talking about NSEvent.


29
00:00:58,946 --> 00:01:00,836
We'll take a small jump and go


30
00:01:00,836 --> 00:01:02,226
into some foundation features


31
00:01:02,486 --> 00:01:03,606
including some geometry


32
00:01:03,606 --> 00:01:05,105
enhancements and new formatters


33
00:01:05,226 --> 00:01:06,706
to make localization easier than


34
00:01:06,706 --> 00:01:07,006
ever.


35
00:01:07,516 --> 00:01:09,186
And then we'll wrap things up


36
00:01:09,186 --> 00:01:10,246
with some notes on system


37
00:01:10,246 --> 00:01:14,006
extensions in macOS 10.15.


38
00:01:14,136 --> 00:01:15,846
So, before we do that, though,


39
00:01:15,846 --> 00:01:18,616
let's go ahead and address the


40
00:01:18,616 --> 00:01:18,996
big thing.


41
00:01:18,996 --> 00:01:22,586
In macOS 10.15, AppKit is not


42
00:01:22,586 --> 00:01:24,016
the only UI framework on the


43
00:01:24,016 --> 00:01:24,546
system.


44
00:01:24,896 --> 00:01:26,676
We have two new UI frameworks


45
00:01:26,676 --> 00:01:27,296
joining us.


46
00:01:28,246 --> 00:01:30,116
So, one of these you've probably


47
00:01:30,116 --> 00:01:31,356
already heard of and that's


48
00:01:31,356 --> 00:01:31,706
UIKit.


49
00:01:31,706 --> 00:01:35,156
In macOS 10.15, you can


50
00:01:35,156 --> 00:01:37,416
recompile your apps and run your


51
00:01:37,476 --> 00:01:38,546
iPad apps on the Mac.


52
00:01:39,206 --> 00:01:40,766
And if you have a


53
00:01:40,766 --> 00:01:42,556
well-maintained AppKit app, this


54
00:01:42,556 --> 00:01:44,376
is probably not going to be very


55
00:01:44,376 --> 00:01:45,236
interesting for you.


56
00:01:45,986 --> 00:01:48,446
But, if you have an iPad app


57
00:01:48,446 --> 00:01:49,706
you've never brought to the Mac


58
00:01:49,706 --> 00:01:50,976
or you've had an iPad app you've


59
00:01:50,976 --> 00:01:52,236
been investing a lot in the last


60
00:01:52,236 --> 00:01:53,626
decade, not so much the Mac,


61
00:01:53,946 --> 00:01:55,436
this could be very neat.


62
00:01:55,616 --> 00:01:58,046
You will still use AppKit to add


63
00:01:58,046 --> 00:01:59,306
the finishing touches to your


64
00:01:59,306 --> 00:02:00,446
UIKit app for things like


65
00:02:00,446 --> 00:02:02,006
toolbar and Touch Bar support.


66
00:02:02,616 --> 00:02:05,026
But we think that can be very


67
00:02:05,026 --> 00:02:05,446
interesting.


68
00:02:05,446 --> 00:02:07,936
The other new framework-- and


69
00:02:07,936 --> 00:02:09,006
we're really excited about


70
00:02:09,006 --> 00:02:10,366
this-- is SwiftUI.


71
00:02:11,126 --> 00:02:13,206
And SwiftUI is this neat


72
00:02:13,206 --> 00:02:15,206
declarative way of describing


73
00:02:15,206 --> 00:02:16,536
your user interfaces and the


74
00:02:16,536 --> 00:02:18,366
transitions between them, ways


75
00:02:18,366 --> 00:02:19,726
of binding them to your model


76
00:02:19,726 --> 00:02:20,856
data.


77
00:02:20,856 --> 00:02:22,656
And this we think is a great way


78
00:02:22,656 --> 00:02:23,496
for making UIs.


79
00:02:23,496 --> 00:02:25,066
It's Swift native and supports


80
00:02:25,066 --> 00:02:26,136
all sorts of Swift language


81
00:02:26,136 --> 00:02:27,166
features that we really like.


82
00:02:27,876 --> 00:02:29,236
Again, this is something you


83
00:02:29,236 --> 00:02:30,236
will use in conjunction with


84
00:02:30,236 --> 00:02:30,686
AppKit.


85
00:02:30,686 --> 00:02:31,876
You will embed it in view


86
00:02:31,876 --> 00:02:33,326
hierarchies potentially all over


87
00:02:33,326 --> 00:02:33,816
the place.


88
00:02:33,986 --> 00:02:35,956
So, there are sessions about of


89
00:02:35,956 --> 00:02:37,066
these frameworks all throughout


90
00:02:37,066 --> 00:02:38,156
the week and we think you'll


91
00:02:38,156 --> 00:02:40,626
enjoy them.


92
00:02:40,816 --> 00:02:42,386
On to AppKit.


93
00:02:42,386 --> 00:02:45,966
So, in macOS 10.15, we have some


94
00:02:45,966 --> 00:02:47,566
new system colors in NSColor.


95
00:02:47,566 --> 00:02:49,436
We have teal and indigo.


96
00:02:49,576 --> 00:02:51,786
These are system colors which


97
00:02:51,786 --> 00:02:53,056
means they're actually dynamic.


98
00:02:53,116 --> 00:02:54,536
Depending on which appearance


99
00:02:54,536 --> 00:02:56,146
you use they can look


100
00:02:56,146 --> 00:02:56,586
differently.


101
00:02:57,666 --> 00:02:59,806
But we think these are great


102
00:02:59,806 --> 00:03:00,916
colors and you'll enjoy using


103
00:03:00,916 --> 00:03:01,586
them in your apps.


104
00:03:02,966 --> 00:03:04,326
We also have an under the hood


105
00:03:04,326 --> 00:03:05,816
change in NSColor we want to


106
00:03:05,816 --> 00:03:06,546
talk about.


107
00:03:06,736 --> 00:03:08,606
And that's-- that NSColor is now


108
00:03:08,606 --> 00:03:10,486
using the tagged pointer system


109
00:03:10,676 --> 00:03:13,116
we also use for NSNumber and


110
00:03:13,246 --> 00:03:13,796
NSString.


111
00:03:13,836 --> 00:03:15,486
And what is a tagged pointer?


112
00:03:15,936 --> 00:03:18,236
Well, normally for NSColor, we


113
00:03:18,236 --> 00:03:19,216
would store the various


114
00:03:19,216 --> 00:03:20,396
component values or other


115
00:03:20,396 --> 00:03:22,116
information as eye bars in an


116
00:03:22,116 --> 00:03:23,226
allocated object.


117
00:03:23,226 --> 00:03:25,216
And with tagged pointers, we


118
00:03:25,216 --> 00:03:26,126
instead condense that


119
00:03:26,126 --> 00:03:27,536
information down to a smaller


120
00:03:27,536 --> 00:03:29,176
number of bits and store in the


121
00:03:29,176 --> 00:03:29,916
pointer itself.


122
00:03:30,296 --> 00:03:31,546
So, there's no separate


123
00:03:31,546 --> 00:03:32,146
allocation.


124
00:03:32,866 --> 00:03:34,286
If you had code that was very


125
00:03:34,286 --> 00:03:35,376
heavily allocating or


126
00:03:35,376 --> 00:03:37,086
deallocating NSColors, you're


127
00:03:37,086 --> 00:03:38,186
going to notice a performance


128
00:03:38,186 --> 00:03:39,616
one from this, so we're excited


129
00:03:39,616 --> 00:03:39,786
here.


130
00:03:41,446 --> 00:03:43,426
Generally, that's going to be an


131
00:03:43,426 --> 00:03:45,016
invisible change for you but


132
00:03:45,016 --> 00:03:46,176
there is a case I want to point


133
00:03:47,146 --> 00:03:47,426
out.


134
00:03:47,426 --> 00:03:48,746
If you're accessing a derived


135
00:03:48,816 --> 00:03:49,856
property of the color, for


136
00:03:49,856 --> 00:03:52,296
example the CGColor, with the


137
00:03:52,296 --> 00:03:54,256
non-tagged version, that could


138
00:03:54,256 --> 00:03:55,666
be cached as an eye bar in the


139
00:03:55,666 --> 00:03:57,036
color and it's possible the


140
00:03:57,036 --> 00:03:58,966
CGColor would live as long as


141
00:03:58,966 --> 00:03:59,466
the NSColor.


142
00:04:00,446 --> 00:04:01,786
In the snippet we have on


143
00:04:01,786 --> 00:04:04,086
screen, you could see that we


144
00:04:04,086 --> 00:04:05,496
passed that CGColor to a


145
00:04:05,496 --> 00:04:07,376
ContextSetFillColorWithColor,


146
00:04:07,376 --> 00:04:09,096
and that would have worked OK in


147
00:04:09,096 --> 00:04:09,576
the past.


148
00:04:10,166 --> 00:04:11,836
With tagged pointers, using it


149
00:04:11,836 --> 00:04:13,176
outside the autorelease pool is


150
00:04:13,176 --> 00:04:14,216
potentially hazardous.


151
00:04:14,216 --> 00:04:15,806
So, it'd be a good hygiene not


152
00:04:15,806 --> 00:04:17,266
to do that anyway but something


153
00:04:17,266 --> 00:04:21,096
to be aware of just in case.


154
00:04:22,226 --> 00:04:24,886
So, a lot of us have used color


155
00:04:24,886 --> 00:04:25,196
panel.


156
00:04:25,936 --> 00:04:27,986
And there is a near and dear to


157
00:04:27,986 --> 00:04:29,726
us eyedropper tool in the color


158
00:04:29,726 --> 00:04:31,276
panel that lets you click it and


159
00:04:31,276 --> 00:04:32,996
bring up a magnifier like this


160
00:04:33,186 --> 00:04:34,706
and then select a specific color


161
00:04:34,706 --> 00:04:36,836
on screen to read the RGB values


162
00:04:36,836 --> 00:04:36,986
of.


163
00:04:37,136 --> 00:04:40,686
In macOS 10.15, we're exposing


164
00:04:40,686 --> 00:04:42,076
this functionality to you too


165
00:04:42,436 --> 00:04:43,526
with a new class called


166
00:04:43,626 --> 00:04:44,546
NSColorSampler.


167
00:04:45,306 --> 00:04:47,096
So, NSColorSampler is very


168
00:04:47,096 --> 00:04:47,476
simple.


169
00:04:47,586 --> 00:04:49,206
It has a single class method on


170
00:04:49,206 --> 00:04:50,226
it called Show.


171
00:04:50,736 --> 00:04:52,246
You pass a block to show and we


172
00:04:52,246 --> 00:04:53,286
will call you back with the


173
00:04:53,286 --> 00:04:54,736
selected color or nil if the


174
00:04:54,736 --> 00:04:56,466
user canceled out of this.


175
00:04:56,746 --> 00:04:58,456
And we're really excited to


176
00:04:58,456 --> 00:04:59,466
share our implementation with


177
00:04:59,466 --> 00:04:59,816
you too.


178
00:04:59,996 --> 00:05:01,606
If you have your own


179
00:05:01,606 --> 00:05:02,896
implementation something to be


180
00:05:02,896 --> 00:05:05,986
aware of in macOS 10.15 is that


181
00:05:05,986 --> 00:05:07,496
Screen Recording is going to


182
00:05:07,546 --> 00:05:08,856
prompt for user permission.


183
00:05:09,066 --> 00:05:10,876
And this is something that


184
00:05:10,876 --> 00:05:12,096
doesn't happen if you use


185
00:05:12,236 --> 00:05:13,636
NSColorSampler itself.


186
00:05:15,976 --> 00:05:18,846
There's another NSColor API that


187
00:05:18,846 --> 00:05:19,916
we find incredibly useful.


188
00:05:19,916 --> 00:05:21,306
We call it the Dynamic Color


189
00:05:21,306 --> 00:05:21,796
Provider.


190
00:05:22,296 --> 00:05:23,636
And it's really just a new


191
00:05:23,636 --> 00:05:25,246
initializer on NSColor.


192
00:05:25,496 --> 00:05:27,236
It takes two arguments.


193
00:05:27,606 --> 00:05:28,846
One of these arguments is a


194
00:05:28,846 --> 00:05:31,086
block and that block accepts an


195
00:05:31,086 --> 00:05:31,726
NSAppearance.


196
00:05:32,776 --> 00:05:34,316
When we go to resolve the color


197
00:05:34,526 --> 00:05:35,596
either because we're drawing it


198
00:05:35,596 --> 00:05:37,036
in a bitmap context or writing


199
00:05:37,036 --> 00:05:38,396
it to a file or using it as a


200
00:05:38,396 --> 00:05:39,516
layer background color, we're


201
00:05:39,976 --> 00:05:41,696
going to call this block with


202
00:05:41,696 --> 00:05:42,526
whatever appearance is


203
00:05:42,526 --> 00:05:43,636
appropriate at the time.


204
00:05:44,386 --> 00:05:46,496
In our snippet on screen, we use


205
00:05:46,496 --> 00:05:47,736
the NSAppearance bestMatch


206
00:05:47,736 --> 00:05:49,066
method to tell us whether the


207
00:05:49,066 --> 00:05:50,926
requested appearance was more


208
00:05:50,926 --> 00:05:53,596
like aqua or more like darkAqua.


209
00:05:53,596 --> 00:05:55,066
And we have hard-coded colors


210
00:05:55,066 --> 00:05:56,056
for each of those cases.


211
00:05:57,026 --> 00:05:58,326
This can be very useful where


212
00:05:58,326 --> 00:05:58,956
you want to have some


213
00:05:58,956 --> 00:06:00,336
programatic decisions and


214
00:06:00,336 --> 00:06:02,576
dynamism in your use of NSColor


215
00:06:02,576 --> 00:06:04,106
in your application and this is


216
00:06:04,106 --> 00:06:05,216
much simpler than trying to


217
00:06:05,216 --> 00:06:06,806
propagate a hard-coded literal


218
00:06:06,806 --> 00:06:08,506
color across a view hierarchy on


219
00:06:08,506 --> 00:06:09,206
appearance change.


220
00:06:09,926 --> 00:06:12,106
So I mentioned there were two


221
00:06:12,106 --> 00:06:12,686
arguments.


222
00:06:13,076 --> 00:06:14,516
The other argument is a name.


223
00:06:14,696 --> 00:06:17,006
And the name is very significant


224
00:06:17,406 --> 00:06:18,516
for coding purposes.


225
00:06:18,736 --> 00:06:20,176
If you send one of these colors


226
00:06:20,176 --> 00:06:21,396
over an NSConnection-- an


227
00:06:21,466 --> 00:06:23,486
NSXPCConnection, when we decode


228
00:06:23,486 --> 00:06:24,496
it we're going to look it up by


229
00:06:24,496 --> 00:06:24,826
name.


230
00:06:25,006 --> 00:06:26,346
So it's also important to


231
00:06:26,346 --> 00:06:27,436
register that color on both


232
00:06:27,436 --> 00:06:27,976
sides of the connection.


233
00:06:31,616 --> 00:06:33,186
So colors are great.


234
00:06:33,186 --> 00:06:33,996
NSColor is great.


235
00:06:34,166 --> 00:06:35,126
And they're all better with


236
00:06:35,126 --> 00:06:36,176
screens to view them on.


237
00:06:36,966 --> 00:06:37,866
So we'll talk about some


238
00:06:37,866 --> 00:06:38,886
NSScreen improvements.


239
00:06:39,316 --> 00:06:41,326
If you're ever implemented a


240
00:06:41,326 --> 00:06:42,876
screen picker control, you may


241
00:06:42,876 --> 00:06:43,796
have wanted to have a


242
00:06:43,796 --> 00:06:45,766
user-facing string to identify


243
00:06:45,766 --> 00:06:46,956
an NSScreen with.


244
00:06:47,316 --> 00:06:48,916
And if you use the inherited


245
00:06:48,916 --> 00:06:50,276
description method from


246
00:06:50,306 --> 00:06:52,276
NSObject, your users probably


247
00:06:52,276 --> 00:06:54,216
were not content with NSScreen


248
00:06:54,216 --> 00:06:57,386
0x6000261e460.


249
00:06:58,956 --> 00:07:00,906
So, in macOS 10.15,


250
00:07:01,066 --> 00:07:03,236
NSScreen.localizedName will give


251
00:07:03,236 --> 00:07:05,396
you a nice human readable string


252
00:07:05,576 --> 00:07:06,636
to describe that screen.


253
00:07:08,296 --> 00:07:11,296
All right, talking about screens


254
00:07:11,296 --> 00:07:11,946
more generally.


255
00:07:12,166 --> 00:07:13,646
Over the last many years,


256
00:07:13,646 --> 00:07:15,026
screens have been getting


257
00:07:15,026 --> 00:07:16,486
brighter and brighter and


258
00:07:16,486 --> 00:07:16,836
brighter.


259
00:07:17,246 --> 00:07:18,856
And there are very few people


260
00:07:19,236 --> 00:07:20,846
who run their screens at max


261
00:07:20,886 --> 00:07:21,646
brightness anymore.


262
00:07:21,826 --> 00:07:24,626
And if we apply this to a


263
00:07:24,626 --> 00:07:26,626
specific picture, we can imagine


264
00:07:26,626 --> 00:07:28,376
that black is a zero component


265
00:07:28,376 --> 00:07:30,326
value and one is the white


266
00:07:30,326 --> 00:07:31,056
component value.


267
00:07:31,366 --> 00:07:33,516
And as we dim that screen, we're


268
00:07:33,516 --> 00:07:34,906
sort of compressing what one


269
00:07:34,906 --> 00:07:36,176
means in absolute terms.


270
00:07:36,176 --> 00:07:38,086
We are emitting fewer photons


271
00:07:38,086 --> 00:07:39,556
per unit value in our software.


272
00:07:40,726 --> 00:07:42,416
But that monitor hasn't lost


273
00:07:42,416 --> 00:07:43,606
that ability to produce bright


274
00:07:43,606 --> 00:07:44,126
colors.


275
00:07:44,686 --> 00:07:46,796
We can instead allow Extended


276
00:07:46,796 --> 00:07:48,776
Dynamic Range content, content


277
00:07:48,776 --> 00:07:50,046
that isn't clamped in the zero


278
00:07:50,046 --> 00:07:51,716
to one range and keep using the


279
00:07:51,716 --> 00:07:53,096
maximum brightness potential of


280
00:07:53,096 --> 00:07:55,056
that monitor to make some images


281
00:07:55,316 --> 00:07:56,706
where we have things brighter


282
00:07:56,876 --> 00:07:58,066
than our reference white point.


283
00:07:58,186 --> 00:08:00,596
And this isn't actually a new


284
00:08:00,596 --> 00:08:01,016
feature.


285
00:08:01,146 --> 00:08:01,986
This is something you've been


286
00:08:01,986 --> 00:08:03,586
able to do on a number of Macs


287
00:08:03,796 --> 00:08:05,206
since macOS 10.11.


288
00:08:06,056 --> 00:08:07,526
There's two APIs that would help


289
00:08:07,526 --> 00:08:08,046
you do this.


290
00:08:09,096 --> 00:08:10,596
One of them is


291
00:08:10,596 --> 00:08:12,416
NSScreen.maximumExtended


292
00:08:12,416 --> 00:08:14,436
DynamicRangeColorComponentValue.


293
00:08:15,596 --> 00:08:16,576
It actually does stuff.


294
00:08:16,576 --> 00:08:17,846
It's not just the longest


295
00:08:17,846 --> 00:08:19,116
Objective-C property name you've


296
00:08:19,116 --> 00:08:19,576
ever seen.


297
00:08:20,066 --> 00:08:22,626
And what we would do is when


298
00:08:22,626 --> 00:08:23,946
your system was in the Extended


299
00:08:23,946 --> 00:08:25,626
Dynamic Range mode, it would go


300
00:08:25,626 --> 00:08:26,856
ahead and tell you the maximum


301
00:08:26,856 --> 00:08:28,216
component value you could use


302
00:08:28,216 --> 00:08:29,596
before clipping would happen, so


303
00:08:29,596 --> 00:08:31,786
that could be 1.3 for example.


304
00:08:33,236 --> 00:08:34,426
If the system wasn't in this


305
00:08:34,426 --> 00:08:37,006
mode, it would just return 1.0.


306
00:08:37,296 --> 00:08:38,596
So you put the system in this


307
00:08:38,596 --> 00:08:40,076
mode using a different API and


308
00:08:40,176 --> 00:08:41,936
that is CAMetalLayer.wants


309
00:08:41,936 --> 00:08:43,586
ExtendedDynamicRangeContent.


310
00:08:44,196 --> 00:08:45,046
There is also an API


311
00:08:45,366 --> 00:08:46,626
NSOpenGLView called


312
00:08:46,626 --> 00:08:47,816
wantsExtendedDynamic


313
00:08:47,816 --> 00:08:49,426
RangeOpenGLSurface.


314
00:08:49,426 --> 00:08:50,476
And when either of those is set


315
00:08:50,476 --> 00:08:51,866
to true, you can get that extra


316
00:08:51,866 --> 00:08:52,856
headroom from this API.


317
00:08:53,906 --> 00:08:55,936
So something we've added in


318
00:08:55,936 --> 00:08:58,426
macOS 10.15 isn't even longer


319
00:08:58,426 --> 00:08:59,576
Objective-C property name.


320
00:08:59,706 --> 00:09:02,216
The important bit is actually


321
00:09:02,216 --> 00:09:02,736
shorter.


322
00:09:02,936 --> 00:09:04,426
That's the maximum potential


323
00:09:04,426 --> 00:09:04,736
piece.


324
00:09:05,376 --> 00:09:06,646
And this will tell you that


325
00:09:06,646 --> 00:09:08,086
headroom, that maximum value,


326
00:09:08,336 --> 00:09:10,066
even if the system isn't in the


327
00:09:10,126 --> 00:09:11,926
extended dynamic range mode, and


328
00:09:12,376 --> 00:09:14,426
that can be very useful if you


329
00:09:14,426 --> 00:09:15,436
are working with extended


330
00:09:15,436 --> 00:09:16,736
dynamic range content, you might


331
00:09:16,736 --> 00:09:18,486
have multiple possible pipelines


332
00:09:18,486 --> 00:09:19,716
you can send your image data


333
00:09:19,716 --> 00:09:20,036
through.


334
00:09:20,526 --> 00:09:22,136
And a floating-point pipeline


335
00:09:22,136 --> 00:09:23,596
for extended content is probably


336
00:09:23,596 --> 00:09:25,496
more expensive than a BGRA


337
00:09:25,496 --> 00:09:26,566
pipeline, for example.


338
00:09:26,616 --> 00:09:28,146
So knowing that you have that


339
00:09:28,146 --> 00:09:29,286
headroom to play with ahead of


340
00:09:29,286 --> 00:09:31,216
time let you conditionalize that


341
00:09:31,216 --> 00:09:31,606
support.


342
00:09:32,916 --> 00:09:35,296
So there's another API I want to


343
00:09:35,296 --> 00:09:37,586
talk about specifically for the


344
00:09:37,586 --> 00:09:38,716
new Apple display we saw


345
00:09:38,716 --> 00:09:39,176
yesterday.


346
00:09:39,776 --> 00:09:41,606
And that display is absolutely


347
00:09:41,606 --> 00:09:43,366
amazing because of how bright it


348
00:09:43,366 --> 00:09:43,706
can get.


349
00:09:43,746 --> 00:09:45,316
It can sustain a thousand nits


350
00:09:45,316 --> 00:09:45,906
indefinitely.


351
00:09:46,576 --> 00:09:48,446
And because of that ability, we


352
00:09:48,446 --> 00:09:49,646
like to say it's a reference


353
00:09:49,646 --> 00:09:50,576
quality display.


354
00:09:50,606 --> 00:09:52,466
We can say that for a specific


355
00:09:52,636 --> 00:09:53,846
component value, there were will


356
00:09:53,846 --> 00:09:55,496
be an absolute number of nits


357
00:09:55,496 --> 00:09:56,166
for that pixel.


358
00:09:56,366 --> 00:09:58,836
Now, it's very bright but it's


359
00:09:58,836 --> 00:09:59,976
not infinitely bright.


360
00:10:00,046 --> 00:10:02,946
If you go ahead and produce a


361
00:10:02,946 --> 00:10:04,346
bright enough pixel value, it


362
00:10:04,346 --> 00:10:05,266
won't actually be able to


363
00:10:05,266 --> 00:10:06,776
represent it and that reference


364
00:10:06,776 --> 00:10:08,036
quality attribute we talked


365
00:10:08,036 --> 00:10:09,616
about will be compromised.


366
00:10:09,616 --> 00:10:10,836
We'll have to scale the image


367
00:10:10,836 --> 00:10:12,506
content down to fit in the


368
00:10:12,506 --> 00:10:13,596
brightness range available.


369
00:10:14,046 --> 00:10:15,226
And that's what the NSScreen


370
00:10:15,226 --> 00:10:16,516
maximum reference value is


371
00:10:16,516 --> 00:10:16,966
telling you.


372
00:10:17,016 --> 00:10:18,736
If you exceed this value, you're


373
00:10:18,736 --> 00:10:19,856
not going to be able to dish out


374
00:10:19,856 --> 00:10:20,946
absolute nits anymore.


375
00:10:24,056 --> 00:10:27,536
OK. So I mentioned CAMetalLayer


376
00:10:27,536 --> 00:10:28,506
as part of a way of getting


377
00:10:28,506 --> 00:10:29,976
extended dynamic range content.


378
00:10:30,456 --> 00:10:31,776
And I want to point out


379
00:10:31,776 --> 00:10:33,256
something that if you're using


380
00:10:33,256 --> 00:10:35,096
MetalLayer on the Mac today, you


381
00:10:35,096 --> 00:10:36,906
should be doing, and that you


382
00:10:36,906 --> 00:10:38,066
should be paying attention to


383
00:10:38,066 --> 00:10:39,656
which screen and which metal


384
00:10:39,656 --> 00:10:41,166
device you're going to see


385
00:10:41,166 --> 00:10:42,096
MetalLayer is going to be


386
00:10:42,096 --> 00:10:42,686
displayed on.


387
00:10:42,686 --> 00:10:44,666
That's a little convoluted.


388
00:10:44,756 --> 00:10:46,376
You have to get your window and


389
00:10:46,376 --> 00:10:47,686
your window screen and your


390
00:10:47,686 --> 00:10:48,946
screen's device description.


391
00:10:49,296 --> 00:10:50,836
And then you have to ask it for


392
00:10:50,836 --> 00:10:52,226
this hard-coded string that you


393
00:10:52,226 --> 00:10:53,526
found on our documentation but


394
00:10:53,526 --> 00:10:54,986
we never exported in any of our


395
00:10:54,986 --> 00:10:55,326
headers.


396
00:10:56,476 --> 00:10:57,806
And finally you'll pass that CD


397
00:10:57,806 --> 00:10:59,356
direct display to figure out


398
00:10:59,356 --> 00:11:00,246
which device to use.


399
00:11:00,956 --> 00:11:02,136
And it's worth it because that


400
00:11:02,136 --> 00:11:03,746
will allow you to avoid moving


401
00:11:03,746 --> 00:11:05,776
the data between GPUs across the


402
00:11:05,776 --> 00:11:08,256
system bus but we've made this


403
00:11:08,256 --> 00:11:09,526
better in macOS 10.15.


404
00:11:10,206 --> 00:11:12,316
CAMetalLayer and MetalView have


405
00:11:12,316 --> 00:11:13,646
a new preferred device property


406
00:11:13,646 --> 00:11:14,806
that will answer that question


407
00:11:14,806 --> 00:11:15,066
for you.


408
00:11:16,536 --> 00:11:17,676
It really reduces your code


409
00:11:17,676 --> 00:11:18,276
around this.


410
00:11:18,716 --> 00:11:20,426
So we're excited that you get to


411
00:11:20,426 --> 00:11:21,106
use that this year.


412
00:11:21,316 --> 00:11:24,236
And that covers what we wanted


413
00:11:24,236 --> 00:11:25,226
to say about screens.


414
00:11:25,456 --> 00:11:27,586
And now we're going to go into a


415
00:11:27,586 --> 00:11:28,886
whole diversity of text


416
00:11:28,886 --> 00:11:29,316
features.


417
00:11:30,086 --> 00:11:31,696
The first of these I want to


418
00:11:31,696 --> 00:11:34,346
mention is NSTextView uses


419
00:11:34,346 --> 00:11:35,946
adaptive color mapping for dark


420
00:11:35,946 --> 00:11:36,486
appearance.


421
00:11:36,986 --> 00:11:38,076
And this is a feature that you


422
00:11:38,076 --> 00:11:39,506
can turn on and off and text at


423
00:11:39,506 --> 00:11:39,656
it.


424
00:11:39,696 --> 00:11:41,466
I have snapshots of them in both


425
00:11:41,466 --> 00:11:42,576
the aqua and darkAqua


426
00:11:42,576 --> 00:11:44,596
appearances using colors from


427
00:11:44,596 --> 00:11:46,156
the system crown crayon picker.


428
00:11:46,156 --> 00:11:47,256
And you can see that when this


429
00:11:47,256 --> 00:11:49,056
feature is activated, snow and


430
00:11:49,056 --> 00:11:50,346
licorice for example almost


431
00:11:50,346 --> 00:11:51,276
invert colors.


432
00:11:51,536 --> 00:11:54,286
Meanwhile the more saturated and


433
00:11:54,286 --> 00:11:56,176
vibrant colors retain that same


434
00:11:56,176 --> 00:11:57,526
color character but changed


435
00:11:57,526 --> 00:11:59,226
brightness to better match the


436
00:11:59,226 --> 00:12:00,006
appearance therein.


437
00:12:01,356 --> 00:12:02,576
So this can be very useful for


438
00:12:02,576 --> 00:12:03,746
making text use with plain


439
00:12:03,746 --> 00:12:04,796
content where you want them to


440
00:12:04,796 --> 00:12:05,746
fit in with the current


441
00:12:05,746 --> 00:12:06,166
appearance.


442
00:12:06,586 --> 00:12:07,766
And it can be very useful for


443
00:12:07,766 --> 00:12:09,506
each text documents where the


444
00:12:09,506 --> 00:12:11,086
desire to make them fit it is


445
00:12:11,086 --> 00:12:12,396
more important than making them


446
00:12:12,396 --> 00:12:14,626
appear exactly as they will on a


447
00:12:14,626 --> 00:12:15,716
printed page for example.


448
00:12:16,436 --> 00:12:17,666
Generally, we think this is the


449
00:12:17,666 --> 00:12:19,466
right thing to do but if you


450
00:12:19,466 --> 00:12:20,626
have an app that's focused


451
00:12:20,626 --> 00:12:21,796
around authoring rich text


452
00:12:21,796 --> 00:12:23,836
content, you probably want to


453
00:12:23,836 --> 00:12:25,636
either opt out or offer the user


454
00:12:25,636 --> 00:12:27,316
the ability to turn this off so


455
00:12:27,316 --> 00:12:28,946
they can decide that they want a


456
00:12:28,946 --> 00:12:30,876
representation matching printed


457
00:12:31,346 --> 00:12:33,976
content more than their screen.


458
00:12:34,036 --> 00:12:35,746
So I think most people in this


459
00:12:35,746 --> 00:12:36,546
room are familiar with


460
00:12:36,596 --> 00:12:38,246
NSSpellChecker if not as a


461
00:12:38,246 --> 00:12:39,656
developer then as a user.


462
00:12:40,426 --> 00:12:42,656
And in macOS 10.15, we're happy


463
00:12:42,656 --> 00:12:44,066
to announce that NSSpellChecker


464
00:12:44,066 --> 00:12:44,836
has a successor.


465
00:12:44,926 --> 00:12:47,276
And that successor is


466
00:12:47,406 --> 00:12:48,526
NSTextCheckingController.


467
00:12:49,556 --> 00:12:51,896
So, NSSpellChecker works with


468
00:12:51,896 --> 00:12:53,376
NSTextView but


469
00:12:53,376 --> 00:12:55,226
NSTextCheckingController works


470
00:12:55,226 --> 00:12:56,406
for the variety of systems we


471
00:12:56,406 --> 00:12:58,736
use in UIKit and WebKit and


472
00:12:58,736 --> 00:12:59,406
AppKit.


473
00:12:59,406 --> 00:13:00,636
And you can use it yourself by


474
00:13:00,636 --> 00:13:02,036
implementing the NSText checking


475
00:13:02,036 --> 00:13:03,616
client protocol.


476
00:13:03,976 --> 00:13:05,036
But in addition to spell


477
00:13:05,036 --> 00:13:06,276
checking it does other things.


478
00:13:06,276 --> 00:13:07,236
It does grammar checking.


479
00:13:07,516 --> 00:13:09,606
It can do data detection to find


480
00:13:09,606 --> 00:13:10,956
URLs and phone numbers and


481
00:13:10,956 --> 00:13:11,366
dates.


482
00:13:11,926 --> 00:13:13,736
And you can control all of that


483
00:13:13,736 --> 00:13:15,896
and configure whether it's going


484
00:13:15,896 --> 00:13:16,916
to a merely highlight


485
00:13:16,916 --> 00:13:18,516
misspellings or automatically


486
00:13:18,516 --> 00:13:19,036
correct them.


487
00:13:19,496 --> 00:13:20,706
So we think it's a very flexible


488
00:13:20,706 --> 00:13:22,176
API and if you're big on text


489
00:13:22,176 --> 00:13:23,546
input, it's something worth


490
00:13:23,546 --> 00:13:24,666
checking out.


491
00:13:25,356 --> 00:13:27,246
The small edition related to


492
00:13:27,246 --> 00:13:29,506
text is that almost all of the


493
00:13:29,596 --> 00:13:31,396
NSText related classes support


494
00:13:31,396 --> 00:13:32,226
secure coding now.


495
00:13:32,566 --> 00:13:34,386
So if you wanted to use these as


496
00:13:34,386 --> 00:13:36,786
part of a vocabulary over NSText


497
00:13:36,786 --> 00:13:39,126
PC connection, they will work


498
00:13:39,126 --> 00:13:39,746
splendidly.


499
00:13:42,596 --> 00:13:45,566
We're probably all familiar with


500
00:13:45,626 --> 00:13:47,776
NSFont and slightly few of us


501
00:13:47,776 --> 00:13:48,486
are familiar with


502
00:13:48,486 --> 00:13:49,396
NSFontDescriptor.


503
00:13:49,886 --> 00:13:52,836
NSFontDescriptor is a neat class


504
00:13:53,206 --> 00:13:54,666
that lets us look up and


505
00:13:54,666 --> 00:13:56,296
transform fonts using sort of


506
00:13:56,296 --> 00:13:57,756
semantic attributes about them.


507
00:13:58,226 --> 00:13:59,706
So I made a little sample up


508
00:13:59,706 --> 00:13:59,976
here.


509
00:14:00,746 --> 00:14:02,806
And the top row is a font I've


510
00:14:02,806 --> 00:14:04,246
hard-coded in Interface Builder.


511
00:14:04,806 --> 00:14:06,466
But the subsequent rows I've


512
00:14:06,466 --> 00:14:07,516
configured using the


513
00:14:07,516 --> 00:14:08,946
NSFontDescriptor system design


514
00:14:08,946 --> 00:14:11,036
API which is new in macOS 10.15.


515
00:14:11,356 --> 00:14:13,506
And lets me go ahead and say, I


516
00:14:13,506 --> 00:14:14,856
want to switch to a rounder font


517
00:14:14,856 --> 00:14:16,436
or a Serif version or a


518
00:14:16,436 --> 00:14:17,256
monospaced font.


519
00:14:17,256 --> 00:14:19,586
And there's a session about this


520
00:14:19,586 --> 00:14:20,526
which we'll go on to much


521
00:14:20,526 --> 00:14:21,806
greater detail about it but we


522
00:14:21,806 --> 00:14:23,276
think this is a great way of


523
00:14:23,276 --> 00:14:24,676
stylizing your applications.


524
00:14:25,006 --> 00:14:30,516
So, if anyone has a


525
00:14:30,516 --> 00:14:32,956
cross-platform app where they


526
00:14:32,956 --> 00:14:34,556
are writing rich text documents


527
00:14:34,736 --> 00:14:36,896
on both macOS and iOS or even in


528
00:14:36,896 --> 00:14:38,286
app that has not cross-platform


529
00:14:38,286 --> 00:14:39,506
where they are reading documents


530
00:14:39,506 --> 00:14:41,346
from the other platform, you may


531
00:14:41,346 --> 00:14:43,226
have hit a situation where even


532
00:14:43,226 --> 00:14:44,466
though the document is


533
00:14:44,466 --> 00:14:46,226
specifying the same font sizes,


534
00:14:46,526 --> 00:14:47,686
they visually look very


535
00:14:47,686 --> 00:14:48,046
different.


536
00:14:48,166 --> 00:14:49,746
And that's because we have very


537
00:14:49,746 --> 00:14:50,836
different screen densities


538
00:14:50,866 --> 00:14:52,406
between our iOS devices and Mac


539
00:14:52,406 --> 00:14:52,946
devices.


540
00:14:53,136 --> 00:14:57,076
In macOS 10.15, we have new


541
00:14:57,076 --> 00:14:59,316
attributed string APIs that you


542
00:14:59,316 --> 00:15:00,756
can use when reading and writing


543
00:15:01,056 --> 00:15:02,616
attributed strings to rich text


544
00:15:02,616 --> 00:15:03,176
documents.


545
00:15:03,736 --> 00:15:05,426
And you can tell us what the


546
00:15:05,426 --> 00:15:07,106
source and destination operating


547
00:15:07,106 --> 00:15:08,696
systems are and we will


548
00:15:08,696 --> 00:15:11,066
automatically adjust font sizes


549
00:15:11,436 --> 00:15:12,636
to make them appear visually the


550
00:15:12,636 --> 00:15:12,986
same.


551
00:15:13,816 --> 00:15:15,576
In this case we brought our 160


552
00:15:15,576 --> 00:15:17,186
point font down to 120 point


553
00:15:17,516 --> 00:15:18,636
which is roughly where they're


554
00:15:18,636 --> 00:15:20,186
visually the same height.


555
00:15:21,476 --> 00:15:25,096
The last text feature I want to


556
00:15:25,096 --> 00:15:27,076
talk about is an addition to


557
00:15:27,076 --> 00:15:29,086
NSLayoutManager called


558
00:15:29,086 --> 00:15:30,326
usesDefaultHyphenation.


559
00:15:30,996 --> 00:15:32,856
And in the past, you'd be able


560
00:15:32,856 --> 00:15:34,306
to get the NSText Class that's


561
00:15:34,306 --> 00:15:36,046
hyphenate for you by using an


562
00:15:36,046 --> 00:15:38,296
NSParagraph style to control the


563
00:15:38,296 --> 00:15:39,306
threshold of hyphenation.


564
00:15:40,016 --> 00:15:41,606
This layout manager property is


565
00:15:41,606 --> 00:15:42,816
a little bit easier to use.


566
00:15:43,106 --> 00:15:44,306
It defaults to off, in which


567
00:15:44,306 --> 00:15:45,726
case you get no hyphenation like


568
00:15:45,726 --> 00:15:46,266
on the left.


569
00:15:46,626 --> 00:15:47,876
And if you set in on it we'll


570
00:15:47,876 --> 00:15:48,866
pick up a default value for


571
00:15:48,866 --> 00:15:49,376
hyphenation.


572
00:15:49,566 --> 00:15:50,636
And you can see on the right


573
00:15:50,706 --> 00:15:51,616
that we've hyphenated


574
00:15:51,756 --> 00:15:52,646
encyclopedia and


575
00:15:52,786 --> 00:15:53,936
internationalization.


576
00:15:55,726 --> 00:15:57,756
So we think these text APIs will


577
00:15:57,756 --> 00:15:59,116
really help you polish the


578
00:15:59,116 --> 00:16:00,416
corners and edges around your


579
00:16:00,416 --> 00:16:00,976
text systems.


580
00:16:04,446 --> 00:16:05,726
We have some great new stuff in


581
00:16:05,856 --> 00:16:06,436
NSToolbar.


582
00:16:07,546 --> 00:16:09,376
The first edition is a new


583
00:16:09,376 --> 00:16:11,836
property on NSToolbarItem called


584
00:16:11,836 --> 00:16:12,566
isBordered.


585
00:16:14,256 --> 00:16:15,756
In the past, if you wanted to


586
00:16:15,756 --> 00:16:17,106
get this push button style


587
00:16:17,106 --> 00:16:19,586
appearance in an NSToolbar, you


588
00:16:19,586 --> 00:16:20,876
would have to allocate your own


589
00:16:21,076 --> 00:16:22,606
NS-- or instance of NS button


590
00:16:22,746 --> 00:16:24,376
and configure it and then you'd


591
00:16:24,376 --> 00:16:26,296
use it as a custom view on your


592
00:16:26,296 --> 00:16:26,896
toolbar item.


593
00:16:27,046 --> 00:16:28,876
And that would work but it was


594
00:16:28,876 --> 00:16:30,446
extra effort for you and


595
00:16:30,446 --> 00:16:31,766
additionally you couldn't take


596
00:16:31,766 --> 00:16:33,586
advantage of NSToolbarItems


597
00:16:33,586 --> 00:16:35,536
built in support for automatic


598
00:16:35,536 --> 00:16:36,936
enabling and disabling.


599
00:16:37,806 --> 00:16:39,366
But if you go ahead and use this


600
00:16:39,366 --> 00:16:40,846
isBordered property, you'll get


601
00:16:40,846 --> 00:16:41,706
all of that for free.


602
00:16:42,876 --> 00:16:45,516
Additionally, NSToolbarItem has


603
00:16:45,516 --> 00:16:47,376
a new title property which lets


604
00:16:47,376 --> 00:16:48,836
you configure your toolbar items


605
00:16:49,216 --> 00:16:50,676
to be a string-based buttons


606
00:16:50,676 --> 00:16:52,386
instead of iconic ones.


607
00:16:52,856 --> 00:16:54,196
And this is distinct from the


608
00:16:54,196 --> 00:16:55,416
label property which would


609
00:16:55,416 --> 00:16:57,386
appear below these buttons if we


610
00:16:57,386 --> 00:16:58,456
had configured the toolbar as


611
00:16:58,456 --> 00:16:59,226
your labels as well.


612
00:16:59,316 --> 00:17:02,946
And that is not the NSToolbar


613
00:17:02,946 --> 00:17:04,306
related class to gain


614
00:17:04,306 --> 00:17:05,986
functionality in macOS 10.15.


615
00:17:07,056 --> 00:17:08,806
We have also added a number of


616
00:17:08,806 --> 00:17:10,556
features to NSToolbarItem group


617
00:17:10,556 --> 00:17:11,965
to make it incredibly versatile


618
00:17:11,965 --> 00:17:12,376
and useful.


619
00:17:12,846 --> 00:17:14,356
And the first of these is a


620
00:17:14,356 --> 00:17:15,486
number of convenience


621
00:17:15,486 --> 00:17:17,175
constructors for it, and these


622
00:17:17,175 --> 00:17:18,486
are just going to let you build


623
00:17:18,486 --> 00:17:20,886
the same great toolbar UIs in


624
00:17:20,886 --> 00:17:21,866
fewer lines of code.


625
00:17:22,096 --> 00:17:24,175
But NSToolbarItem group has


626
00:17:24,175 --> 00:17:25,526
become more flexible at the same


627
00:17:25,526 --> 00:17:25,896
time.


628
00:17:26,566 --> 00:17:27,606
If you look at the image on the


629
00:17:27,606 --> 00:17:29,226
right side of the screen, you


630
00:17:29,226 --> 00:17:30,716
can see that it now has support


631
00:17:30,716 --> 00:17:32,146
for representing its items as a


632
00:17:32,146 --> 00:17:34,026
segmented control and it can


633
00:17:34,026 --> 00:17:36,056
also represent them as pull-down


634
00:17:36,056 --> 00:17:37,136
and pop-up menus too.


635
00:17:37,546 --> 00:17:39,046
And so this makes it a very


636
00:17:39,046 --> 00:17:40,146
versatile toolbar control


637
00:17:40,146 --> 00:17:42,476
because of the way is uses the


638
00:17:42,476 --> 00:17:43,446
other toolbar items as


639
00:17:43,446 --> 00:17:44,846
vocabulary, we can also


640
00:17:44,846 --> 00:17:46,246
automatically create a collapsed


641
00:17:46,246 --> 00:17:47,916
representation for when you have


642
00:17:47,916 --> 00:17:49,546
too many toolbar items for the


643
00:17:49,546 --> 00:17:50,826
window widths.


644
00:17:54,436 --> 00:17:56,416
There is a very similar effect


645
00:17:56,416 --> 00:17:57,596
you can get using a new


646
00:17:57,746 --> 00:17:59,306
NSMenuToolbarItem class.


647
00:18:00,016 --> 00:18:01,756
And this is much like the menu


648
00:18:01,756 --> 00:18:03,476
item representations of the


649
00:18:03,476 --> 00:18:06,056
toolbar item group but it uses


650
00:18:06,056 --> 00:18:07,716
an NSMenu as currency instead.


651
00:18:08,396 --> 00:18:09,966
And that's significant because


652
00:18:09,966 --> 00:18:11,506
you can use NSMenu features like


653
00:18:11,506 --> 00:18:14,276
submenus or separator items or


654
00:18:14,276 --> 00:18:15,556
even the ability to use a custom


655
00:18:15,556 --> 00:18:16,676
view for your menu items.


656
00:18:16,866 --> 00:18:19,536
So it's a very powerful tool if


657
00:18:19,536 --> 00:18:20,776
you want to have sophisticated


658
00:18:20,776 --> 00:18:22,486
drill-down behaviors in your


659
00:18:24,256 --> 00:18:24,646
toolbar.


660
00:18:24,746 --> 00:18:26,346
NSTouchBar has also received a


661
00:18:26,346 --> 00:18:28,246
few enhancements in macOS 10.15.


662
00:18:28,876 --> 00:18:29,876
The first of these I want to


663
00:18:29,876 --> 00:18:32,156
note is a new class property on


664
00:18:32,216 --> 00:18:33,726
NSTouchBar itself and that's


665
00:18:33,726 --> 00:18:35,086
isAutomaticCustomize


666
00:18:35,086 --> 00:18:36,346
TouchBarMenuItemEndabled.


667
00:18:36,896 --> 00:18:38,216
And that will sound familiar NS


668
00:18:38,216 --> 00:18:40,106
application has that exact same


669
00:18:40,106 --> 00:18:40,556
property.


670
00:18:41,446 --> 00:18:42,946
You could use this Touch Bar one


671
00:18:43,446 --> 00:18:44,916
in a code where you want to


672
00:18:44,916 --> 00:18:46,056
defactor in such a way to not


673
00:18:46,056 --> 00:18:47,346
reference the NSApplication.


674
00:18:47,666 --> 00:18:49,146
And one example of that is if


675
00:18:49,146 --> 00:18:49,986
you're writing UIKit


676
00:18:49,986 --> 00:18:51,316
application, you're not going to


677
00:18:51,316 --> 00:18:52,796
have an NSApplication instance


678
00:18:52,796 --> 00:18:53,526
to talk to anyway.


679
00:18:54,166 --> 00:18:57,886
A more significant control is


680
00:18:57,886 --> 00:19:00,166
the new NSStepper Touch Bar Item


681
00:19:00,166 --> 00:19:00,606
class.


682
00:19:01,286 --> 00:19:03,296
Just like an onscreen stepper,


683
00:19:03,576 --> 00:19:04,696
this is very useful for when


684
00:19:04,696 --> 00:19:06,206
you're doing a discrete entry


685
00:19:06,206 --> 00:19:07,566
for things such as dates and


686
00:19:07,566 --> 00:19:09,766
numbers but given the larger


687
00:19:09,766 --> 00:19:11,046
size in the Touch Bar and the


688
00:19:11,046 --> 00:19:12,706
horizontal layout, you can also


689
00:19:12,706 --> 00:19:13,966
use this for new applications


690
00:19:13,966 --> 00:19:15,996
like visually selecting the tool


691
00:19:15,996 --> 00:19:17,136
on a drawing app.


692
00:19:17,416 --> 00:19:18,606
So we're really excited about


693
00:19:18,606 --> 00:19:19,856
this new Touch Bar Item class.


694
00:19:19,856 --> 00:19:21,186
We think you'll be able to put


695
00:19:21,186 --> 00:19:22,326
it to good use in your


696
00:19:22,326 --> 00:19:23,016
applications.


697
00:19:24,236 --> 00:19:26,446
NSSlider Touch Bar Item has a


698
00:19:26,446 --> 00:19:28,906
few small enhancements too.


699
00:19:28,906 --> 00:19:30,296
You may have experienced a case


700
00:19:30,296 --> 00:19:31,556
were used an NSSlider Touch Bar


701
00:19:31,556 --> 00:19:32,746
Item and it was a little bit too


702
00:19:32,746 --> 00:19:33,776
small for your taste.


703
00:19:34,666 --> 00:19:36,276
You could fix this by grabbing


704
00:19:36,276 --> 00:19:38,166
the slider from the Touch Bar


705
00:19:38,166 --> 00:19:39,936
Item instance and adding auto


706
00:19:39,936 --> 00:19:40,946
layout constraints to it.


707
00:19:40,946 --> 00:19:44,416
In macOS 10.15, you can just set


708
00:19:44,416 --> 00:19:45,346
the minimum slider width


709
00:19:45,346 --> 00:19:46,546
directly on the item and we'll


710
00:19:46,546 --> 00:19:47,456
take care of that for you.


711
00:19:48,396 --> 00:19:50,516
Similarly, if your slider has


712
00:19:50,596 --> 00:19:52,346
global ambitions, you can now


713
00:19:52,346 --> 00:19:53,876
check them by using the maximum


714
00:19:53,876 --> 00:19:54,736
slider width property.


715
00:19:56,256 --> 00:19:59,146
And lastly, we'll talk a little


716
00:19:59,146 --> 00:19:59,976
bit about sidebar metrics.


717
00:20:00,086 --> 00:20:03,196
In macOS 10.15 you can toggle


718
00:20:03,196 --> 00:20:05,026
the size of a sidebar using the


719
00:20:05,026 --> 00:20:06,316
setting and the general pane of


720
00:20:06,316 --> 00:20:07,196
system preferences.


721
00:20:07,306 --> 00:20:09,986
And we default to medium but you


722
00:20:09,986 --> 00:20:11,596
can also use small and large.


723
00:20:12,436 --> 00:20:13,536
And I want to call this out


724
00:20:13,536 --> 00:20:14,856
because if you haven't known


725
00:20:14,856 --> 00:20:16,046
about this feature you maybe


726
00:20:16,046 --> 00:20:17,666
have not been including artwork


727
00:20:17,666 --> 00:20:18,836
appropriate for the small and


728
00:20:18,836 --> 00:20:19,466
large sizes.


729
00:20:19,466 --> 00:20:20,816
So if you're using bitmap


730
00:20:20,816 --> 00:20:21,906
artwork, go ahead and have


731
00:20:21,906 --> 00:20:23,686
representations for that or use


732
00:20:23,686 --> 00:20:24,866
a resolution independent


733
00:20:24,866 --> 00:20:25,206
version.


734
00:20:25,446 --> 00:20:27,506
Similarly, there's a new feature


735
00:20:27,506 --> 00:20:29,356
in macOS 10.15 to allow


736
00:20:29,356 --> 00:20:30,886
automatically picking the light


737
00:20:30,886 --> 00:20:32,186
and the dark appearance, that's


738
00:20:32,186 --> 00:20:33,946
also available in the general


739
00:20:33,946 --> 00:20:34,013
[inaudible].


740
00:20:34,013 --> 00:20:38,776
OK. We covered controls for


741
00:20:38,776 --> 00:20:40,326
toolbars and Touch Bars.


742
00:20:40,326 --> 00:20:41,876
Let's talk about some controls


743
00:20:41,876 --> 00:20:43,346
that are more broadly


744
00:20:43,406 --> 00:20:43,966
applicable.


745
00:20:45,196 --> 00:20:46,776
The first of these, we're


746
00:20:46,776 --> 00:20:47,646
excited to announce this is


747
00:20:47,796 --> 00:20:48,336
NSSwitch.


748
00:20:48,606 --> 00:20:50,716
And NSSwitch is a full subclass


749
00:20:50,716 --> 00:20:51,326
of NSControl.


750
00:20:51,586 --> 00:20:52,806
It supports bindings, it


751
00:20:52,806 --> 00:20:55,846
supports formatters, but it


752
00:20:55,846 --> 00:20:57,966
exists alongside the existing


753
00:20:57,966 --> 00:20:59,016
check box functionality.


754
00:20:59,626 --> 00:21:01,046
A question you probably have in


755
00:21:01,046 --> 00:21:02,316
your mind is when should I use


756
00:21:02,316 --> 00:21:03,686
NSSwitch and when should I use a


757
00:21:03,686 --> 00:21:04,306
checkbox?


758
00:21:04,786 --> 00:21:06,286
And if you are already using a


759
00:21:06,286 --> 00:21:07,886
checkbox, you should probably


760
00:21:07,886 --> 00:21:09,046
keep using a checkbox.


761
00:21:09,046 --> 00:21:10,116
They're generally the right


762
00:21:10,116 --> 00:21:10,846
control to use.


763
00:21:11,746 --> 00:21:13,796
We think NSSwitches are better


764
00:21:13,796 --> 00:21:15,076
used when you have a really


765
00:21:15,076 --> 00:21:16,556
heavy toggle, something that's


766
00:21:16,556 --> 00:21:17,846
toggling a lot of functionality


767
00:21:17,846 --> 00:21:19,096
on and off.


768
00:21:19,096 --> 00:21:20,876
And in this example I have here,


769
00:21:21,216 --> 00:21:22,806
we have a master toggle on the


770
00:21:22,806 --> 00:21:23,826
left which is going to enable


771
00:21:24,066 --> 00:21:26,026
all of the individual sharing


772
00:21:26,026 --> 00:21:26,976
services on the right.


773
00:21:32,046 --> 00:21:34,386
In macOS 10.15, we've invested a


774
00:21:34,386 --> 00:21:35,326
lot of effort in


775
00:21:35,326 --> 00:21:36,086
NSCollectionView.


776
00:21:36,426 --> 00:21:37,826
And one of the things we're


777
00:21:37,826 --> 00:21:39,796
excited to talk about is


778
00:21:39,796 --> 00:21:40,776
compositional layout.


779
00:21:40,776 --> 00:21:42,956
And in this scheme, you no


780
00:21:42,956 --> 00:21:44,256
longer need to subclass


781
00:21:44,316 --> 00:21:46,096
NSCollectionView layout to


782
00:21:46,096 --> 00:21:46,646
modify it.


783
00:21:46,646 --> 00:21:48,976
There are number of interesting


784
00:21:48,976 --> 00:21:51,276
features you can throw in, such


785
00:21:51,276 --> 00:21:53,036
as container-relative sizing,


786
00:21:53,316 --> 00:21:54,896
layout breaks and sections as


787
00:21:54,896 --> 00:21:56,586
well as nestable groups, and


788
00:21:56,586 --> 00:21:57,916
also making individual sections


789
00:21:57,916 --> 00:21:58,546
scrollable.


790
00:21:58,886 --> 00:22:00,326
And of course, all of that works


791
00:22:00,326 --> 00:22:01,756
in both right to left and left


792
00:22:01,756 --> 00:22:02,536
to right languages.


793
00:22:04,326 --> 00:22:05,676
There's also a new collection


794
00:22:05,676 --> 00:22:07,306
view feature called diffable


795
00:22:07,306 --> 00:22:08,016
data sources.


796
00:22:08,076 --> 00:22:11,196
And these are identifier-based


797
00:22:11,196 --> 00:22:12,556
data sources that let us track


798
00:22:12,556 --> 00:22:13,636
things like the addition or


799
00:22:13,636 --> 00:22:15,156
removal of items or the movement


800
00:22:15,156 --> 00:22:16,826
of an item between two locations


801
00:22:17,136 --> 00:22:18,536
and we can automatically infer


802
00:22:18,536 --> 00:22:19,926
the right animations to use.


803
00:22:20,396 --> 00:22:21,466
So this means you won't have to


804
00:22:21,466 --> 00:22:23,356
use performBatchUpdates or


805
00:22:23,356 --> 00:22:24,626
reloadData.


806
00:22:27,796 --> 00:22:30,136
OK, backing away from specific


807
00:22:30,136 --> 00:22:32,346
controls to an IB feature.


808
00:22:32,546 --> 00:22:34,996
IB storyboards are a really


809
00:22:34,996 --> 00:22:36,666
great way of connecting the


810
00:22:36,666 --> 00:22:38,166
various view controllers in your


811
00:22:38,166 --> 00:22:38,756
application.


812
00:22:40,346 --> 00:22:42,836
And historically, your view


813
00:22:42,836 --> 00:22:44,076
controller would be initialized


814
00:22:44,076 --> 00:22:45,256
through in it with coder and


815
00:22:45,256 --> 00:22:46,656
you'd have to find a different


816
00:22:46,656 --> 00:22:48,456
way of getting different


817
00:22:48,456 --> 00:22:49,296
information into the view


818
00:22:49,296 --> 00:22:49,746
controller.


819
00:22:49,746 --> 00:22:51,956
That wasn't necessarily


820
00:22:51,956 --> 00:22:53,076
difficult but it did mean your


821
00:22:53,076 --> 00:22:54,396
code was factored maybe more


822
00:22:54,396 --> 00:22:55,406
broadly than you wanted.


823
00:22:55,756 --> 00:22:57,506
If you look at the snippet here


824
00:22:57,506 --> 00:22:59,116
you can I have a function called


825
00:22:59,116 --> 00:23:01,926
showPetDetails and this returns


826
00:23:01,926 --> 00:23:03,566
a new view controller passing


827
00:23:03,566 --> 00:23:06,586
along a coder from IB as well as


828
00:23:06,586 --> 00:23:07,876
inserting our own notion of a


829
00:23:07,876 --> 00:23:08,756
selected pet name.


830
00:23:10,256 --> 00:23:11,316
So this is a great way of


831
00:23:11,316 --> 00:23:12,316
bundling those separate


832
00:23:12,316 --> 00:23:13,696
initialization and configuration


833
00:23:13,696 --> 00:23:14,116
steps.


834
00:23:14,936 --> 00:23:16,506
And the other important thing to


835
00:23:16,506 --> 00:23:18,146
note about this is there's this


836
00:23:18,266 --> 00:23:20,246
IBSegueAction annotation


837
00:23:20,246 --> 00:23:21,216
attached to this function.


838
00:23:21,776 --> 00:23:23,786
And by doing that, we can go to


839
00:23:23,786 --> 00:23:25,046
the connections inspector and


840
00:23:25,046 --> 00:23:26,726
interface builder for our segue


841
00:23:27,386 --> 00:23:28,796
and wire it up directly to this


842
00:23:28,796 --> 00:23:29,096
method.


843
00:23:30,206 --> 00:23:31,646
So we think this is very useful


844
00:23:31,886 --> 00:23:33,376
for adding extra configuration


845
00:23:33,376 --> 00:23:34,426
into your view controllers and


846
00:23:34,426 --> 00:23:34,976
storyboards.


847
00:23:40,636 --> 00:23:43,006
So, a great feature of all


848
00:23:43,006 --> 00:23:44,606
AppKit controls is how they


849
00:23:44,606 --> 00:23:45,496
support auto layout.


850
00:23:46,096 --> 00:23:47,656
They automatically know how to


851
00:23:47,656 --> 00:23:49,176
measure their content and feed


852
00:23:49,176 --> 00:23:50,406
that into auto layout engine.


853
00:23:50,406 --> 00:23:52,516
And that means that you can do


854
00:23:52,516 --> 00:23:54,066
things like change the strings


855
00:23:54,066 --> 00:23:55,496
on these text fields and buttons


856
00:23:55,716 --> 00:23:56,786
and auto layout would just


857
00:23:56,786 --> 00:23:58,446
automatically reflow view


858
00:23:58,446 --> 00:23:59,926
hierarchy and window for us to


859
00:23:59,926 --> 00:24:00,366
look great.


860
00:24:02,756 --> 00:24:05,136
Sometimes, though, there are UIs


861
00:24:05,136 --> 00:24:07,026
where that's actually not


862
00:24:07,026 --> 00:24:07,586
important.


863
00:24:07,796 --> 00:24:09,656
So in this grid view, it's the


864
00:24:09,656 --> 00:24:11,516
grid that is determining the


865
00:24:11,516 --> 00:24:13,206
size of everything else and the


866
00:24:13,206 --> 00:24:14,916
intrinsic size of these labels


867
00:24:14,916 --> 00:24:16,016
doesn't actually matter.


868
00:24:16,996 --> 00:24:18,426
But normally, AppKit would still


869
00:24:18,426 --> 00:24:19,556
go ahead and measure these


870
00:24:19,556 --> 00:24:20,696
controls and feed them into the


871
00:24:20,696 --> 00:24:22,036
auto layout engine even though


872
00:24:22,036 --> 00:24:23,376
they won't affect the final


873
00:24:23,376 --> 00:24:23,726
result.


874
00:24:24,316 --> 00:24:28,106
In macOS 10.15, you can turn


875
00:24:28,106 --> 00:24:28,496
that off.


876
00:24:29,306 --> 00:24:31,156
NSView gains two new properties


877
00:24:31,456 --> 00:24:32,746
to turn off the measurement


878
00:24:32,786 --> 00:24:34,276
behaviors for both horizontal


879
00:24:34,276 --> 00:24:35,406
and vertical axis.


880
00:24:35,846 --> 00:24:36,996
And we think that can be a great


881
00:24:36,996 --> 00:24:38,246
way of getting back some


882
00:24:38,246 --> 00:24:40,176
performance in UIs where you


883
00:24:40,176 --> 00:24:41,276
know the intrinsic size of the


884
00:24:41,276 --> 00:24:42,556
control isn't going to matter.


885
00:24:42,916 --> 00:24:48,226
There's one other controller


886
00:24:48,226 --> 00:24:49,166
related thing I want to talk


887
00:24:49,166 --> 00:24:50,356
about and it's a bit more broad


888
00:24:50,356 --> 00:24:51,056
than NSControl.


889
00:24:51,056 --> 00:24:53,596
That's NSResponder and its


890
00:24:53,596 --> 00:24:56,026
behavior relating to block


891
00:24:56,026 --> 00:24:56,406
capture.


892
00:24:57,266 --> 00:24:58,876
So if you look at our snippet on


893
00:24:58,876 --> 00:25:00,686
screen, you can see we have two


894
00:25:00,686 --> 00:25:01,126
blocks.


895
00:25:01,126 --> 00:25:02,796
We have an outer block that's


896
00:25:02,796 --> 00:25:03,806
going to be executed on the


897
00:25:03,806 --> 00:25:05,756
background thread and we have an


898
00:25:05,756 --> 00:25:07,216
inner block that's going to be


899
00:25:07,216 --> 00:25:08,496
executed on the main thread.


900
00:25:09,046 --> 00:25:10,196
And this is a fairly common


901
00:25:10,196 --> 00:25:10,576
pattern.


902
00:25:10,576 --> 00:25:12,016
We do our work in the background


903
00:25:12,496 --> 00:25:13,746
and then we go ahead and assign


904
00:25:13,746 --> 00:25:14,876
the results of that work, to the


905
00:25:14,876 --> 00:25:16,196
UI on the main thread.


906
00:25:16,976 --> 00:25:19,706
But this snippet in macOS 10.14


907
00:25:20,076 --> 00:25:21,626
could have led to crashes and


908
00:25:21,626 --> 00:25:22,146
the corruption.


909
00:25:22,746 --> 00:25:24,276
And that's because if the only


910
00:25:24,276 --> 00:25:26,136
thing retaining this field is


911
00:25:26,136 --> 00:25:27,996
these blocks, the order of


912
00:25:27,996 --> 00:25:29,156
destruction of the blocks isn't


913
00:25:29,156 --> 00:25:29,606
defined.


914
00:25:30,346 --> 00:25:31,906
If the outer block, deallocates


915
00:25:31,906 --> 00:25:33,356
last, the text field will


916
00:25:33,356 --> 00:25:34,696
deallocate on a background


917
00:25:34,696 --> 00:25:36,716
thread and the text field by


918
00:25:36,716 --> 00:25:38,326
virtue of being a responder is


919
00:25:38,326 --> 00:25:39,526
part of the responder chain.


920
00:25:39,866 --> 00:25:40,966
It can be part of the view


921
00:25:40,966 --> 00:25:42,496
hierarchy or the key view loop,


922
00:25:42,886 --> 00:25:44,246
so there's all these global data


923
00:25:44,246 --> 00:25:45,456
structures that aren't safe to


924
00:25:45,456 --> 00:25:47,096
modify from the background which


925
00:25:47,096 --> 00:25:47,876
is what dealloc would do.


926
00:25:47,876 --> 00:25:52,306
In macOS 10.15, this isn't a


927
00:25:52,306 --> 00:25:52,766
problem.


928
00:25:53,126 --> 00:25:54,886
NSResponder will automatically


929
00:25:54,886 --> 00:25:56,646
move the dealloc method for it


930
00:25:56,646 --> 00:25:58,266
and its descendants to the main


931
00:25:58,266 --> 00:25:58,636
thread.


932
00:25:59,486 --> 00:26:00,766
So it becomes safe to capture


933
00:26:00,766 --> 00:26:02,136
these in blocks without being


934
00:26:02,136 --> 00:26:03,216
concerned about where those


935
00:26:03,216 --> 00:26:04,126
blocks are released.


936
00:26:04,126 --> 00:26:05,646
And we think this is going to


937
00:26:06,006 --> 00:26:07,396
remove a whole complex set of


938
00:26:07,466 --> 00:26:08,766
crashes from many of your apps


939
00:26:09,096 --> 00:26:10,536
where the corruption from doing


940
00:26:10,536 --> 00:26:11,586
work on a background thread


941
00:26:11,896 --> 00:26:13,326
isn't visible until seconds or


942
00:26:13,326 --> 00:26:13,956
minutes afterward.


943
00:26:21,586 --> 00:26:23,386
So, I want to talk about open


944
00:26:23,386 --> 00:26:24,546
and safe panels for a moment.


945
00:26:25,416 --> 00:26:27,976
We have a fairly broad change in


946
00:26:27,976 --> 00:26:29,036
macOS 10.15.


947
00:26:29,836 --> 00:26:31,826
And that's that open and safe


948
00:26:31,826 --> 00:26:34,156
panels are now using a separate


949
00:26:34,156 --> 00:26:34,666
process.


950
00:26:35,366 --> 00:26:37,256
This is a behavior that's


951
00:26:37,256 --> 00:26:38,256
already been present for


952
00:26:38,256 --> 00:26:40,256
sandboxed applications and we've


953
00:26:40,256 --> 00:26:41,256
simply brought it over to the


954
00:26:41,256 --> 00:26:41,986
remaining apps.


955
00:26:43,026 --> 00:26:44,386
Generally, this should be a


956
00:26:44,386 --> 00:26:45,106
silent change.


957
00:26:45,106 --> 00:26:45,816
We don't think you're going to


958
00:26:45,816 --> 00:26:48,096
notice anything here apart from


959
00:26:48,096 --> 00:26:49,366
some performance and security


960
00:26:49,366 --> 00:26:50,266
benefits.


961
00:26:50,366 --> 00:26:51,596
However, if you were


962
00:26:51,596 --> 00:26:53,286
sub-classing open and safe panel


963
00:26:53,286 --> 00:26:54,806
and relying on specific view


964
00:26:54,806 --> 00:26:56,426
hierarchy configurations, you


965
00:26:56,426 --> 00:26:58,116
might run into problems and we'd


966
00:26:58,116 --> 00:26:59,446
be happy to see you in the labs


967
00:26:59,446 --> 00:27:00,706
to talk about those and help


968
00:27:00,706 --> 00:27:00,976
work through them.


969
00:27:05,256 --> 00:27:06,966
We also have some new NSWorspace


970
00:27:06,966 --> 00:27:10,246
methods in macOS 10.15.


971
00:27:10,246 --> 00:27:11,436
These are methods that can open


972
00:27:11,436 --> 00:27:13,276
one or more URLs or open an


973
00:27:13,276 --> 00:27:13,946
application.


974
00:27:14,526 --> 00:27:15,596
And that will sound familiar


975
00:27:15,596 --> 00:27:16,996
because you'll think NSWorspace


976
00:27:16,996 --> 00:27:18,536
already has methods to do that.


977
00:27:18,926 --> 00:27:21,166
It does but the new methods are


978
00:27:21,166 --> 00:27:21,826
asynchronous.


979
00:27:21,906 --> 00:27:23,056
So they're not going to block


980
00:27:23,056 --> 00:27:23,836
the main thread at all.


981
00:27:24,396 --> 00:27:25,676
When the application finishes


982
00:27:25,676 --> 00:27:27,086
launching or the operation is


983
00:27:27,086 --> 00:27:28,436
canceled, we will call you back


984
00:27:28,436 --> 00:27:29,536
using a completion handler.


985
00:27:29,656 --> 00:27:31,436
And in addition to be an


986
00:27:31,436 --> 00:27:33,406
asynchronous, these methods also


987
00:27:33,406 --> 00:27:35,016
offer a high degree of control


988
00:27:35,256 --> 00:27:36,916
over how we launch those URLs


989
00:27:37,086 --> 00:27:37,906
and applications.


990
00:27:38,036 --> 00:27:40,516
And that control is achieved


991
00:27:40,886 --> 00:27:42,746
through the new NSWorspace open


992
00:27:42,746 --> 00:27:43,886
configuration object.


993
00:27:44,256 --> 00:27:46,936
This is just a sampling of the


994
00:27:46,936 --> 00:27:48,626
knobs it has to play with but


995
00:27:48,626 --> 00:27:50,196
you can control whether the user


996
00:27:50,196 --> 00:27:51,296
needs to participate on this


997
00:27:51,336 --> 00:27:51,806
process.


998
00:27:51,806 --> 00:27:53,306
So for example, if you're


999
00:27:53,306 --> 00:27:54,676
requesting a server mount or if


1000
00:27:54,676 --> 00:27:55,776
we don't know what application


1001
00:27:55,776 --> 00:27:57,126
to use, the user might need to


1002
00:27:57,126 --> 00:27:59,036
pick which application and you


1003
00:27:59,036 --> 00:28:00,036
can instead suppress that


1004
00:28:00,036 --> 00:28:01,216
behavior and just cancel the


1005
00:28:01,216 --> 00:28:01,946
open process.


1006
00:28:02,046 --> 00:28:04,036
You can also control whether an


1007
00:28:04,036 --> 00:28:05,666
application or document is added


1008
00:28:05,666 --> 00:28:06,476
to the Recents menu.


1009
00:28:07,266 --> 00:28:08,836
And there's an entire variety of


1010
00:28:08,836 --> 00:28:09,936
things for controlling which


1011
00:28:09,936 --> 00:28:11,276
applications can be hidden on


1012
00:28:11,276 --> 00:28:12,856
launch or which are activated in


1013
00:28:12,856 --> 00:28:13,886
the background or foreground.


1014
00:28:14,566 --> 00:28:16,256
So we think whatever your URL


1015
00:28:16,256 --> 00:28:17,676
application opening needs,


1016
00:28:17,966 --> 00:28:19,416
NSWorspace will accommodate it


1017
00:28:19,416 --> 00:28:21,006
wonderfully in macOS 10.15.


1018
00:28:25,656 --> 00:28:27,686
We're going to talk events for a


1019
00:28:27,686 --> 00:28:28,106
little bit.


1020
00:28:28,106 --> 00:28:30,536
And there's a feature I want to


1021
00:28:30,536 --> 00:28:30,926
show you.


1022
00:28:31,216 --> 00:28:33,176
And this is-- if you hover your


1023
00:28:33,176 --> 00:28:36,096
mouse over the green button in


1024
00:28:36,096 --> 00:28:37,656
the window title bar, you're


1025
00:28:37,656 --> 00:28:38,706
going to get this new menu.


1026
00:28:39,216 --> 00:28:40,506
And the first set of options


1027
00:28:40,746 --> 00:28:42,106
concerns things like making a


1028
00:28:42,106 --> 00:28:43,356
window full screen or


1029
00:28:43,386 --> 00:28:44,926
positioning it in a shared full


1030
00:28:44,926 --> 00:28:45,686
screen space.


1031
00:28:46,046 --> 00:28:47,286
And those are fairly useful.


1032
00:28:47,776 --> 00:28:49,006
But there's another feature that


1033
00:28:49,006 --> 00:28:50,936
I think is even more useful and


1034
00:28:50,936 --> 00:28:52,136
that's the ability to move a


1035
00:28:52,136 --> 00:28:53,486
window to another display.


1036
00:28:53,636 --> 00:28:56,176
As someone who is constantly


1037
00:28:56,176 --> 00:28:57,526
moving their laptop to different


1038
00:28:57,526 --> 00:28:59,056
external monitors, I found this


1039
00:28:59,056 --> 00:29:01,296
to be incredibly useful but you


1040
00:29:01,296 --> 00:29:02,486
don't actually have to use a


1041
00:29:02,486 --> 00:29:05,086
conventional display, iPads will


1042
00:29:05,086 --> 00:29:06,466
function as additional displays


1043
00:29:06,466 --> 00:29:06,936
now too.


1044
00:29:08,626 --> 00:29:09,536
So you kind of see where I'm


1045
00:29:09,536 --> 00:29:10,456
going with this given that the


1046
00:29:10,456 --> 00:29:12,066
iPad application is named pencil


1047
00:29:12,066 --> 00:29:13,296
draw and we have this beautiful


1048
00:29:13,296 --> 00:29:14,726
cursive script on there.


1049
00:29:15,596 --> 00:29:17,106
This supports Apple Pencil so


1050
00:29:17,106 --> 00:29:19,456
many iPads can now function as


1051
00:29:19,456 --> 00:29:21,146
tablet devices for Macs.


1052
00:29:22,076 --> 00:29:23,656
So in macOS 10.15, we're going


1053
00:29:23,656 --> 00:29:25,286
to have many more tablet users.


1054
00:29:25,976 --> 00:29:27,676
If you've been thinking about


1055
00:29:27,676 --> 00:29:28,986
adding tablet support to your


1056
00:29:28,986 --> 00:29:30,716
app at any point in the last


1057
00:29:30,716 --> 00:29:32,726
many years, now is a great time


1058
00:29:32,726 --> 00:29:33,336
to adopt it.


1059
00:29:33,336 --> 00:29:35,186
So I'm going to show what you


1060
00:29:35,186 --> 00:29:36,666
need to know to do that.


1061
00:29:37,676 --> 00:29:40,836
Tablet events come in basically


1062
00:29:40,836 --> 00:29:41,926
as normal mouse events.


1063
00:29:43,646 --> 00:29:44,866
There's a difference though and


1064
00:29:44,866 --> 00:29:46,286
that's if you pay attention to


1065
00:29:46,326 --> 00:29:47,706
the NSEvents subtype field,


1066
00:29:48,026 --> 00:29:49,726
there is a tablet point value


1067
00:29:49,726 --> 00:29:49,906
there.


1068
00:29:50,036 --> 00:29:52,226
And when you see a tablet point


1069
00:29:52,226 --> 00:29:53,876
event it, one, comes from a


1070
00:29:53,876 --> 00:29:56,226
tablet but it's also going to


1071
00:29:56,226 --> 00:29:57,466
have pressure information


1072
00:29:57,466 --> 00:29:57,956
attached.


1073
00:29:58,596 --> 00:29:59,596
And paying attention to that


1074
00:29:59,596 --> 00:30:01,016
pressure information is critical


1075
00:30:01,016 --> 00:30:02,236
for making things like that nice


1076
00:30:02,236 --> 00:30:03,716
cursive stroke where you have


1077
00:30:03,946 --> 00:30:05,506
different pen width throughout


1078
00:30:05,796 --> 00:30:05,866
it.


1079
00:30:07,176 --> 00:30:09,186
If you've used the pencil APIs


1080
00:30:09,186 --> 00:30:11,026
on iOS in the past, there was


1081
00:30:11,236 --> 00:30:12,846
something that you could do by


1082
00:30:12,846 --> 00:30:13,956
registering a handler to


1083
00:30:13,956 --> 00:30:15,946
retroactively receive updates to


1084
00:30:15,946 --> 00:30:17,826
pressure in the past.


1085
00:30:17,826 --> 00:30:19,076
That is not present on the Mac.


1086
00:30:19,176 --> 00:30:20,226
You can just pay attention to


1087
00:30:20,226 --> 00:30:21,576
the pressure field in the


1088
00:30:21,576 --> 00:30:22,366
NSEvent.


1089
00:30:25,096 --> 00:30:26,586
There's another convention


1090
00:30:26,666 --> 00:30:28,056
related to the Apple Pencil I


1091
00:30:28,056 --> 00:30:28,696
want to mention.


1092
00:30:29,316 --> 00:30:30,666
And this is that you can double


1093
00:30:30,666 --> 00:30:32,476
tap it the side of the pencil


1094
00:30:32,956 --> 00:30:34,696
and it will switch whatever the


1095
00:30:34,696 --> 00:30:35,846
current tool is in the drawing


1096
00:30:35,846 --> 00:30:36,576
app for example.


1097
00:30:37,156 --> 00:30:38,406
And we call this the change mode


1098
00:30:38,406 --> 00:30:38,676
event.


1099
00:30:39,206 --> 00:30:40,416
There's a new event type for it


1100
00:30:40,416 --> 00:30:41,766
on this event and there's a new


1101
00:30:41,766 --> 00:30:43,416
responder method to handle


1102
00:30:43,416 --> 00:30:44,756
directing that through the


1103
00:30:44,756 --> 00:30:45,526
responder chain.


1104
00:30:46,716 --> 00:30:49,866
In many cases, you might want to


1105
00:30:49,866 --> 00:30:51,426
have tablet functionality that


1106
00:30:51,426 --> 00:30:53,116
isn't actually anchored in a


1107
00:30:53,116 --> 00:30:54,676
responder subclass like a view


1108
00:30:54,936 --> 00:30:56,616
but you might still want to


1109
00:30:56,616 --> 00:30:58,026
handle events directly and


1110
00:30:58,026 --> 00:30:59,456
there's a way you can accomplish


1111
00:30:59,456 --> 00:31:01,206
this using the existing local


1112
00:31:01,206 --> 00:31:02,086
event monitor API.


1113
00:31:03,256 --> 00:31:04,556
So if you look at the snippet on


1114
00:31:04,556 --> 00:31:06,336
the bottom of the screen, you


1115
00:31:06,476 --> 00:31:08,276
can see that we use the NSEvent


1116
00:31:08,276 --> 00:31:09,726
add local event monitor for


1117
00:31:09,726 --> 00:31:12,326
events function to catch these


1118
00:31:12,326 --> 00:31:13,256
change mode events.


1119
00:31:13,356 --> 00:31:14,706
And then we just cycle through


1120
00:31:14,706 --> 00:31:16,106
our tools and we return the


1121
00:31:16,106 --> 00:31:17,646
event allowing it to flow


1122
00:31:17,646 --> 00:31:18,186
through the rest of the


1123
00:31:18,186 --> 00:31:18,886
responder chain.


1124
00:31:19,006 --> 00:31:21,496
So that can be a great way of


1125
00:31:21,496 --> 00:31:23,506
factoring your code more


1126
00:31:23,506 --> 00:31:23,926
usefully.


1127
00:31:27,746 --> 00:31:30,836
OK. Let's talk about a


1128
00:31:30,836 --> 00:31:31,766
foundation feature.


1129
00:31:32,296 --> 00:31:33,526
We have some new geometry data


1130
00:31:33,526 --> 00:31:33,916
types.


1131
00:31:33,916 --> 00:31:35,036
I know normally when we get into


1132
00:31:35,036 --> 00:31:36,496
foundation everyone is on the


1133
00:31:36,496 --> 00:31:37,136
edge of their seat.


1134
00:31:37,796 --> 00:31:39,276
This year, you can pick which


1135
00:31:39,276 --> 00:31:42,736
edge of the seat you're on


1136
00:31:42,736 --> 00:31:43,086
[laughter].


1137
00:31:43,086 --> 00:31:44,366
The data types are


1138
00:31:44,366 --> 00:31:45,896
NSDirectionalRectEdge,


1139
00:31:46,366 --> 00:31:48,446
NSDirectionalEdgeInsets, and


1140
00:31:48,566 --> 00:31:49,336
NSRectAlignment.


1141
00:31:49,446 --> 00:31:51,176
And instead of working in


1142
00:31:51,176 --> 00:31:53,106
currency like min-X or max-X or


1143
00:31:53,106 --> 00:31:54,946
left and right, these are using


1144
00:31:55,036 --> 00:31:56,606
leading and trailing identifiers


1145
00:31:56,606 --> 00:31:57,026
instead.


1146
00:31:57,216 --> 00:31:58,806
So they'll automatically flip


1147
00:31:58,806 --> 00:32:00,486
based on context in the left to


1148
00:32:00,486 --> 00:32:02,106
right or right to left system.


1149
00:32:02,376 --> 00:32:04,546
And NSCollectionVeiw uses these


1150
00:32:04,546 --> 00:32:05,876
exactly for this purpose.


1151
00:32:06,006 --> 00:32:07,246
We think you'll be able to adopt


1152
00:32:07,246 --> 00:32:08,136
them directly in your


1153
00:32:08,136 --> 00:32:08,976
applications too.


1154
00:32:12,936 --> 00:32:14,456
Another foundation feature I


1155
00:32:14,456 --> 00:32:15,466
want to talk about that will


1156
00:32:15,466 --> 00:32:17,036
help with localization is new


1157
00:32:17,036 --> 00:32:17,766
formatters.


1158
00:32:18,906 --> 00:32:20,576
The first of these is the


1159
00:32:20,576 --> 00:32:23,436
NSRelativeDateFormatter.


1160
00:32:23,436 --> 00:32:25,096
And NSRelativeDateFormatter has


1161
00:32:25,096 --> 00:32:26,256
two important properties, a


1162
00:32:26,256 --> 00:32:28,176
dateTimeStyle which allows you


1163
00:32:28,226 --> 00:32:29,416
to pick whether you're sort of


1164
00:32:29,416 --> 00:32:30,536
working in absolute units or


1165
00:32:30,536 --> 00:32:31,986
more colloquial terms, the one


1166
00:32:31,986 --> 00:32:33,536
week ago versus last week, as


1167
00:32:33,786 --> 00:32:35,096
well as the unitStyle


1168
00:32:35,096 --> 00:32:37,336
controlling how verbose or how


1169
00:32:37,416 --> 00:32:39,486
terse our languages.


1170
00:32:42,056 --> 00:32:43,376
There's also a new


1171
00:32:43,436 --> 00:32:44,686
NSListFormatter class.


1172
00:32:45,416 --> 00:32:46,506
And NSListFormatter is


1173
00:32:46,506 --> 00:32:47,826
interesting in that instead of


1174
00:32:47,826 --> 00:32:49,676
formatting sort of a scalar


1175
00:32:49,676 --> 00:32:51,606
object, it will format an array


1176
00:32:51,606 --> 00:32:52,636
of objects instead.


1177
00:32:52,636 --> 00:32:55,206
And it will do that by using a


1178
00:32:55,206 --> 00:32:56,856
separate item formatter for each


1179
00:32:56,856 --> 00:32:57,776
object individually.


1180
00:32:58,646 --> 00:33:01,316
The value the ListFormatter adds


1181
00:33:01,316 --> 00:33:02,546
is in knowing where to place the


1182
00:33:02,546 --> 00:33:04,196
commas between the individual


1183
00:33:04,196 --> 00:33:06,226
formatted strings as well as


1184
00:33:06,226 --> 00:33:07,366
whether an Oxford comma is


1185
00:33:07,366 --> 00:33:08,646
necessary or a conjunction.


1186
00:33:08,996 --> 00:33:10,906
There's a section covering this


1187
00:33:10,906 --> 00:33:12,256
in much greater detail later,


1188
00:33:12,336 --> 00:33:14,046
which I encourage you to check


1189
00:33:14,046 --> 00:33:14,926
out.


1190
00:33:17,116 --> 00:33:19,356
Foundation also has a new


1191
00:33:19,356 --> 00:33:20,746
feature we're very excited about


1192
00:33:20,746 --> 00:33:21,516
called Combine.


1193
00:33:21,566 --> 00:33:24,826
And Combine is a Swift API for


1194
00:33:24,826 --> 00:33:26,356
connecting properties of the


1195
00:33:26,356 --> 00:33:27,886
objects in your applications to


1196
00:33:27,886 --> 00:33:29,876
other properties in your


1197
00:33:29,876 --> 00:33:30,406
application.


1198
00:33:31,246 --> 00:33:33,386
So a specific example I want to


1199
00:33:33,386 --> 00:33:35,666
show is this awakeFromNib method


1200
00:33:35,666 --> 00:33:37,336
we've implemented where we go


1201
00:33:37,336 --> 00:33:38,766
ahead and we bind to the name


1202
00:33:38,766 --> 00:33:40,296
property from our model object


1203
00:33:40,666 --> 00:33:42,266
to the value of an NSTextField.


1204
00:33:42,266 --> 00:33:44,136
And whenever that name changes,


1205
00:33:44,336 --> 00:33:45,326
that text field is going to


1206
00:33:45,326 --> 00:33:46,186
update its string.


1207
00:33:46,756 --> 00:33:48,696
So this is incredibly powerful.


1208
00:33:48,996 --> 00:33:50,526
It has applications beyond just


1209
00:33:50,526 --> 00:33:51,236
UI binding.


1210
00:33:51,556 --> 00:33:52,616
And there's another section


1211
00:33:52,616 --> 00:33:54,136
dedicated to specifically this


1212
00:33:54,136 --> 00:33:54,926
that we think is going to be


1213
00:33:54,926 --> 00:33:55,536
fantastic.


1214
00:33:56,366 --> 00:33:57,616
So go ahead and check that out


1215
00:33:57,616 --> 00:33:57,956
this week too.


1216
00:34:02,056 --> 00:34:04,076
And finally, I want to mention


1217
00:34:04,076 --> 00:34:04,996
some changes in system


1218
00:34:04,996 --> 00:34:06,316
extensions for Mac OS.


1219
00:34:07,476 --> 00:34:08,916
We have a small addition to the


1220
00:34:08,916 --> 00:34:11,036
system extension family in the


1221
00:34:11,036 --> 00:34:13,306
form of a non-UI file provider


1222
00:34:13,306 --> 00:34:14,116
action extension.


1223
00:34:14,636 --> 00:34:16,735
And if you are familiar with UI


1224
00:34:16,735 --> 00:34:18,735
base file-- or file provider


1225
00:34:18,735 --> 00:34:20,146
action extension, this is the


1226
00:34:20,146 --> 00:34:21,786
same thing but sometimes you


1227
00:34:21,786 --> 00:34:23,255
just don't need that extra UI.


1228
00:34:23,366 --> 00:34:24,876
You can do without it and this


1229
00:34:24,876 --> 00:34:25,876
satisfies that need.


1230
00:34:27,696 --> 00:34:29,686
Something else that we think is


1231
00:34:29,686 --> 00:34:31,755
even more interesting is there's


1232
00:34:31,755 --> 00:34:33,525
functionality that in the past


1233
00:34:33,525 --> 00:34:34,335
you would have had to use a


1234
00:34:34,335 --> 00:34:35,706
kernel extension to add at the


1235
00:34:35,706 --> 00:34:36,056
OS.


1236
00:34:36,156 --> 00:34:37,636
And we've now made system


1237
00:34:37,636 --> 00:34:39,545
extensions to do similar things.


1238
00:34:40,196 --> 00:34:41,616
We have new network extensions.


1239
00:34:41,985 --> 00:34:43,585
We have DriverKit to help


1240
00:34:43,585 --> 00:34:45,106
writing certain types of device


1241
00:34:45,106 --> 00:34:45,606
drivers.


1242
00:34:46,056 --> 00:34:47,356
And we have a new endpoint


1243
00:34:47,356 --> 00:34:48,626
security system that will help


1244
00:34:48,626 --> 00:34:49,775
write antivirus software.


1245
00:34:50,396 --> 00:34:51,556
So if you have been writing


1246
00:34:51,556 --> 00:34:52,696
kernel extension all these


1247
00:34:52,696 --> 00:34:53,755
years, we think these will be


1248
00:34:53,755 --> 00:34:54,815
very useful for you.


1249
00:34:55,315 --> 00:34:57,106
We're excited with a security


1250
00:34:57,106 --> 00:34:58,016
enhancements we get to make


1251
00:34:58,016 --> 00:34:59,046
around this and we think you'll


1252
00:34:59,046 --> 00:35:00,256
be excited about not doing


1253
00:35:00,256 --> 00:35:03,096
kernel-mode debugging anymore.


1254
00:35:03,806 --> 00:35:06,226
So, that covers our additions.


1255
00:35:06,916 --> 00:35:09,066
I want to remind you of many of


1256
00:35:09,066 --> 00:35:10,446
the great things that we covered


1257
00:35:10,446 --> 00:35:10,696
today.


1258
00:35:11,496 --> 00:35:12,816
We had additions for NSColor


1259
00:35:12,816 --> 00:35:14,046
including new dynamic system


1260
00:35:14,046 --> 00:35:15,746
colors, new ways of embedding


1261
00:35:15,746 --> 00:35:17,396
your own programmatic dynamism,


1262
00:35:17,396 --> 00:35:19,786
under the NSColor system as well


1263
00:35:19,786 --> 00:35:20,996
as the ColorSampler class you


1264
00:35:20,996 --> 00:35:22,466
can use yourself for picking


1265
00:35:22,466 --> 00:35:23,756
colors directly from the screen.


1266
00:35:24,436 --> 00:35:27,346
We covered a number of APIs and


1267
00:35:27,346 --> 00:35:28,946
NSScreen including those for you


1268
00:35:28,946 --> 00:35:30,376
to make a great usage of


1269
00:35:30,376 --> 00:35:31,616
extended dynamic range.


1270
00:35:31,686 --> 00:35:34,506
And we have an entire variety of


1271
00:35:34,506 --> 00:35:35,436
text enhancements.


1272
00:35:35,496 --> 00:35:38,066
If you want your apps to look


1273
00:35:38,066 --> 00:35:39,546
great in Dark Mode and you're


1274
00:35:39,696 --> 00:35:41,016
presenting either simple or rich


1275
00:35:41,016 --> 00:35:43,356
text, the Dark Mode enhancements


1276
00:35:43,356 --> 00:35:44,656
are going to great, the text


1277
00:35:44,656 --> 00:35:45,636
tracking controllers will let


1278
00:35:45,636 --> 00:35:46,946
you enrich your own text engines


1279
00:35:46,946 --> 00:35:49,066
like never before, and our


1280
00:35:49,066 --> 00:35:51,316
compatibility between iOS and


1281
00:35:51,316 --> 00:35:53,506
Mac OS regarding text sizing is


1282
00:35:53,506 --> 00:35:55,326
very useful especially given the


1283
00:35:55,326 --> 00:35:56,636
presence of UIKit on the Mac


1284
00:35:56,636 --> 00:35:56,946
this year.


1285
00:35:57,916 --> 00:36:00,786
We covered controls like


1286
00:36:00,876 --> 00:36:02,596
NSSwitch as well as collection


1287
00:36:02,596 --> 00:36:02,826
view.


1288
00:36:03,026 --> 00:36:04,416
And we definitely encourage you


1289
00:36:04,416 --> 00:36:05,446
to check out the collection view


1290
00:36:05,446 --> 00:36:06,566
section because collection view


1291
00:36:06,566 --> 00:36:07,846
has become a very important part


1292
00:36:07,846 --> 00:36:08,976
of our UI vocabulary.


1293
00:36:10,386 --> 00:36:11,126
We covered some great


1294
00:36:11,126 --> 00:36:12,416
enhancement for NSToolbar


1295
00:36:12,706 --> 00:36:13,556
allowing you to make push


1296
00:36:13,556 --> 00:36:15,696
buttons more easily and more


1297
00:36:15,696 --> 00:36:17,996
versatile ways of using the tool


1298
00:36:17,996 --> 00:36:18,746
bar item group.


1299
00:36:18,746 --> 00:36:23,006
And then we've also covered some


1300
00:36:23,006 --> 00:36:24,136
things for handling tablet


1301
00:36:24,136 --> 00:36:25,936
events in NSEvent and specific


1302
00:36:25,936 --> 00:36:27,106
support for the Apple Pencil.


1303
00:36:27,536 --> 00:36:28,716
And again, with so many more


1304
00:36:28,716 --> 00:36:30,046
tablet users coming to the Mac


1305
00:36:30,046 --> 00:36:31,586
in the near future, we think if


1306
00:36:31,586 --> 00:36:33,326
your app can use tablets, it's a


1307
00:36:33,376 --> 00:36:34,196
great feature to add.


1308
00:36:34,326 --> 00:36:36,446
And we wrapped up with the


1309
00:36:36,446 --> 00:36:38,906
localization enhancements for NS


1310
00:36:38,906 --> 00:36:40,166
or for foundation geometry data


1311
00:36:40,166 --> 00:36:41,886
types and then new formatters.


1312
00:36:43,286 --> 00:36:44,886
So we hope you're excited to


1313
00:36:44,886 --> 00:36:45,626
adopt these too.


1314
00:36:46,166 --> 00:36:47,386
And please have a great week.


1315
00:36:47,556 --> 00:36:48,976
Thank you very much.


1316
00:36:49,516 --> 00:36:56,500
[ Applause ]

